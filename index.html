<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroNexo Restaurado</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #1e293b; --accent: #22c55e; --bg: #f1f5f9; }
        body { font-family: sans-serif; margin: 0; background: var(--bg); color: var(--primary); }
        
        /* Layout Responsivo */
        .navbar { background: var(--primary); color: white; padding: 1rem; text-align: center; font-weight: bold; }
        .menu-movil { display: flex; justify-content: space-around; background: white; padding: 10px; border-top: 1px solid #ddd; position: fixed; bottom: 0; width: 100%; z-index: 100; }
        .menu-movil button { border: none; background: none; font-size: 0.8rem; color: #64748b; cursor: pointer; }
        .menu-movil button.active { color: var(--accent); }
        
        .container { padding: 15px; max-width: 1000px; margin: auto; }
        .card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        /* Tablas que no se cortan */
        .scroll-table { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 500px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        
        /* Botones grandes para dedos en móvil */
        .btn { background: var(--accent); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .view { display: none; }
        .view.active { display: block; }
    </style>
</head>
<body>

<div class="navbar">AgroNexo Pro V2.0</div>

<div class="container">
    <div id="v-inicio" class="view active">
        <h2>Resumen del Campo</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="card"><h4>Animales</h4><p id="res-ani">--</p></div>
            <div class="card"><h4>Lotes</h4><p id="res-lot">--</p></div>
        </div>
        <div class="card"><h4>Lluvia Total</h4><p id="res-llu">-- mm</p></div>
    </div>

    <div id="v-vaca" class="view">
        <h2>Ganadería (Braford)</h2>
        <div class="card">
            <input id="f-caravana" placeholder="Caravana (Ej: 105)" style="width: 100%; padding: 10px; margin-bottom: 5px;">
            <input id="f-categoria" placeholder="Categoría (Vaca, Toro...)" style="width: 100%; padding: 10px; margin-bottom: 5px;">
            <input id="f-peso" type="number" placeholder="Peso inicial" style="width: 100%; padding: 10px; margin-bottom: 5px;">
            <button class="btn" onclick="addAnimal()">Registrar Animal</button>
        </div>
        <div class="scroll-table">
            <table id="t-vaca"><thead><tr><th>ID</th><th>Cat.</th><th>Peso</th><th>Acción</th></tr></thead><tbody></tbody></table>
        </div>
    </div>

    <div id="v-lote" class="view">
        <h2>Lotes y Cultivos</h2>
        <div class="card">
            <input id="l-nombre" placeholder="Nombre del Lote" style="width: 100%; padding: 10px; margin-bottom: 5px;">
            <input id="l-cultivo" placeholder="Cultivo (Soja, Girasol...)" style="width: 100%; padding: 10px; margin-bottom: 5px;">
            <input id="l-has" type="number" placeholder="Hectáreas" style="width: 100%; padding: 10px;">
            <button class="btn" onclick="addLote()">Crear Lote</button>
        </div>
        <div class="scroll-table">
            <table id="t-lote"><thead><tr><th>Nombre</th><th>Cultivo</th><th>Has</th><th>Acción</th></tr></thead><tbody></tbody></table>
        </div>
    </div>
</div>

<div class="menu-movil">
    <button onclick="go('v-inicio', this)" class="active"><i class="fas fa-chart-line"></i><br>Inicio</button>
    <button onclick="go('v-vaca', this)"><i class="fas fa-cow"></i><br>Vacas</button>
    <button onclick="go('v-lote', this)"><i class="fas fa-seedling"></i><br>Lotes</button>
</div>

<script>
    const API = "https://agronexo-backend.onrender.com";

    function go(id, btn) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.menu-movil button').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
        if(id === 'v-inicio') loadResumen();
        if(id === 'v-vaca') loadGanaderia();
        if(id === 'v-lote') loadLotes();
    }

    async function loadResumen() {
        const r = await fetch(`${API}/api/resumen`).then(res => res.json());
        document.getElementById('res-ani').innerText = r.animales;
        document.getElementById('res-lot').innerText = r.lotes;
        document.getElementById('res-llu').innerText = r.total_lluvia;
    }

    async function addAnimal() {
        const body = {
            caravana: document.getElementById('f-caravana').value,
            categoria: document.getElementById('f-categoria').value,
            peso: document.getElementById('f-peso').value
        };
        await fetch(`${API}/api/ganaderia`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body) });
        loadGanaderia();
    }

    async function loadGanaderia() {
        const d = await fetch(`${API}/api/ganaderia`).then(res => res.json());
        document.querySelector('#t-vaca tbody').innerHTML = d.map(a => `
            <tr><td>${a.caravana}</td><td>${a.categoria}</td><td>${a.peso}kg</td>
            <td><button onclick="delAnimal(${a.id})" style="color:red;border:none;background:none;"><i class="fas fa-trash"></i></button></td></tr>`).join('');
    }

    async function addLote() {
        const body = {
            nombre: document.getElementById('l-nombre').value,
            cultivo: document.getElementById('l-cultivo').value,
            hectareas: document.getElementById('l-has').value
        };
        await fetch(`${API}/api/agricultura`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body) });
        loadLotes();
    }

    async function loadLotes() {
        const d = await fetch(`${API}/api/agricultura`).then(res => res.json());
        document.querySelector('#t-lote tbody').innerHTML = d.map(l => `
            <tr><td>${l.nombre}</td><td>${l.cultivo}</td><td>${l.hectareas} Has</td>
            <td><button style="color:red;border:none;background:none;"><i class="fas fa-trash"></i></button></td></tr>`).join('');
    }

    window.onload = loadResumen;
</script>
</body>
</html>